# Data Field Configuration for alpha-canvas
# This file defines data field aliases and their database access specifications

# ============================================================================
# FnGuide Real Data (Processed by ETL)
# ============================================================================

# Daily returns (calculated from FnGuide adj_close)
# Formula: (price_t - price_t-1) / price_t-1
returns:
  db_type: parquet
  data_type: numeric
  forward_fill: false
  table: FNGUIDE_RETURNS
  index_col: date
  security_col: symbol
  value_col: return
  query: >
    SELECT
      date,
      symbol,
      return
    FROM read_parquet('data/fnguide/returns/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Adjusted close price (수정주가)
fnguide_adj_close:
  db_type: parquet
  data_type: numeric
  forward_fill: false
  table: FNGUIDE_PRICE
  index_col: date
  security_col: symbol
  value_col: adj_close
  query: >
    SELECT
      date,
      symbol,
      adj_close
    FROM read_parquet('data/fnguide/price/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Trading value (거래대금)
fnguide_trading_value:
  db_type: parquet
  data_type: numeric
  forward_fill: false
  table: FNGUIDE_PRICE
  index_col: date
  security_col: symbol
  value_col: trading_value
  query: >
    SELECT
      date,
      symbol,
      trading_value
    FROM read_parquet('data/fnguide/price/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Listed shares - common stock (상장주식수 보통주)
fnguide_listed_shares_common:
  db_type: parquet
  data_type: numeric
  forward_fill: false
  table: FNGUIDE_PRICE
  index_col: date
  security_col: symbol
  value_col: listed_shares_common
  query: >
    SELECT
      date,
      symbol,
      listed_shares_common
    FROM read_parquet('data/fnguide/price/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Float shares (유동주식수)
fnguide_float_shares:
  db_type: parquet
  data_type: numeric
  forward_fill: false
  table: FNGUIDE_PRICE
  index_col: date
  security_col: symbol
  value_col: float_shares
  query: >
    SELECT
      date,
      symbol,
      float_shares
    FROM read_parquet('data/fnguide/price/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Float ratio percentage (유동주식비율)
fnguide_float_ratio_pct:
  db_type: parquet
  data_type: numeric
  forward_fill: false
  table: FNGUIDE_PRICE
  index_col: date
  security_col: symbol
  value_col: float_ratio_pct
  query: >
    SELECT
      date,
      symbol,
      float_ratio_pct
    FROM read_parquet('data/fnguide/price/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Market cap in won (시가총액)
# Note: Converted from millions to won by ETL (multiply by 1,000,000)
fnguide_market_cap:
  db_type: parquet
  data_type: numeric
  forward_fill: false
  table: FNGUIDE_PRICE
  index_col: date
  security_col: symbol
  value_col: market_cap
  query: >
    SELECT
      date,
      symbol,
      market_cap
    FROM read_parquet('data/fnguide/price/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Trading suspended status (거래정지 여부)
# Boolean: True = trading suspended, False = normal trading
fnguide_is_trading_suspended:
  db_type: parquet
  data_type: boolean
  forward_fill: false
  table: FNGUIDE_PRICE
  index_col: date
  security_col: symbol
  value_col: is_trading_suspended
  query: >
    SELECT
      date,
      symbol,
      is_trading_suspended
    FROM read_parquet('data/fnguide/price/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Management issue status (관리종목 여부)
# Boolean: True = has issues, False = general (normal)
fnguide_is_issue:
  db_type: parquet
  data_type: boolean
  forward_fill: false
  table: FNGUIDE_PRICE
  index_col: date
  security_col: symbol
  value_col: is_issue
  query: >
    SELECT
      date,
      symbol,
      is_issue
    FROM read_parquet('data/fnguide/price/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# ============================================================================
# FnGuide Groups (Monthly Data - All Forward-Filled)
# ============================================================================

# FnGuide: Sector classification (섹터)
# Monthly data - forward filled to daily frequency
fnguide_sector:
  db_type: parquet
  data_type: group
  forward_fill: true
  table: FNGUIDE_GROUPS
  index_col: date
  security_col: symbol
  value_col: fn_sector
  query: >
    SELECT
      date,
      symbol,
      fn_sector
    FROM read_parquet('data/fnguide/groups/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Industry group classification (산업 그룹)
# Monthly data - forward filled to daily frequency
fnguide_industry_group:
  db_type: parquet
  data_type: group
  forward_fill: true
  table: FNGUIDE_GROUPS
  index_col: date
  security_col: symbol
  value_col: fn_industry_group
  query: >
    SELECT
      date,
      symbol,
      fn_industry_group
    FROM read_parquet('data/fnguide/groups/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Industry classification (산업)
# Monthly data - forward filled to daily frequency
fnguide_industry:
  db_type: parquet
  data_type: group
  forward_fill: true
  table: FNGUIDE_GROUPS
  index_col: date
  security_col: symbol
  value_col: fn_industry
  query: >
    SELECT
      date,
      symbol,
      fn_industry
    FROM read_parquet('data/fnguide/groups/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Industry group 27 classification (산업 그룹 27)
# Monthly data - forward filled to daily frequency
fnguide_industry_group_27:
  db_type: parquet
  data_type: group
  forward_fill: true
  table: FNGUIDE_GROUPS
  index_col: date
  security_col: symbol
  value_col: fn_industry_group_27
  query: >
    SELECT
      date,
      symbol,
      fn_industry_group_27
    FROM read_parquet('data/fnguide/groups/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# KRX: Exchange sector (거래소 업종)
# Monthly data - forward filled to daily frequency
krx_sector:
  db_type: parquet
  data_type: group
  forward_fill: true
  table: FNGUIDE_GROUPS
  index_col: date
  security_col: symbol
  value_col: krx_sector
  query: >
    SELECT
      date,
      symbol,
      krx_sector
    FROM read_parquet('data/fnguide/groups/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# KRX: Exchange sector detail (거래소 업종 세부분류)
# Monthly data - forward filled to daily frequency
krx_sector_detail:
  db_type: parquet
  data_type: group
  forward_fill: true
  table: FNGUIDE_GROUPS
  index_col: date
  security_col: symbol
  value_col: krx_sector_detail
  query: >
    SELECT
      date,
      symbol,
      krx_sector_detail
    FROM read_parquet('data/fnguide/groups/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# ============================================================================
# FnGuide Fundamentals (Monthly Data - All Forward-Filled)
# ============================================================================

# FnGuide: Sales revenue (매출액)
# Monthly data - forward filled to daily frequency
# Note: Values in raw KRW (converted from thousands by ETL)
fnguide_sales:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_FUNDA
  index_col: date
  security_col: symbol
  value_col: sales
  query: >
    SELECT
      date,
      symbol,
      sales
    FROM read_parquet('data/fnguide/funda/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Common stock capital (보통주자본금)
# Monthly data - forward filled to daily frequency
# Note: Values in raw KRW (converted from thousands by ETL)
fnguide_common_stock_capital:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_FUNDA
  index_col: date
  security_col: symbol
  value_col: common_stock_capital
  query: >
    SELECT
      date,
      symbol,
      common_stock_capital
    FROM read_parquet('data/fnguide/funda/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Deferred tax liabilities (이연법인세부채)
# Monthly data - forward filled to daily frequency
# Note: Values in raw KRW (converted from thousands by ETL)
fnguide_deferred_tax_liabilities:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_FUNDA
  index_col: date
  security_col: symbol
  value_col: deferred_tax_liabilities
  query: >
    SELECT
      date,
      symbol,
      deferred_tax_liabilities
    FROM read_parquet('data/fnguide/funda/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Retained earnings (이익잉여금)
# Monthly data - forward filled to daily frequency
# Note: Values in raw KRW (converted from thousands by ETL)
fnguide_retained_earnings:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_FUNDA
  index_col: date
  security_col: symbol
  value_col: retained_earnings
  query: >
    SELECT
      date,
      symbol,
      retained_earnings
    FROM read_parquet('data/fnguide/funda/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Treasury stock (자기주식)
# Monthly data - forward filled to daily frequency
# Note: Values in raw KRW (converted from thousands by ETL)
fnguide_treasury_stock:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_FUNDA
  index_col: date
  security_col: symbol
  value_col: treasury_stock
  query: >
    SELECT
      date,
      symbol,
      treasury_stock
    FROM read_parquet('data/fnguide/funda/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Capital surplus (자본잉여금)
# Monthly data - forward filled to daily frequency
# Note: Values in raw KRW (converted from thousands by ETL)
fnguide_capital_surplus:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_FUNDA
  index_col: date
  security_col: symbol
  value_col: capital_surplus
  query: >
    SELECT
      date,
      symbol,
      capital_surplus
    FROM read_parquet('data/fnguide/funda/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# ============================================================================
# FnGuide Monthly Price Data (Monthly Aggregated - All Forward-Filled)
# ============================================================================

# FnGuide: Monthly adjusted open price (월간 수정시가)
# Monthly data - forward filled to daily frequency
monthly_adj_open:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_adj_open
  query: >
    SELECT
      date,
      symbol,
      monthly_adj_open
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Monthly adjusted close price (월간 수정주가)
# Monthly data - forward filled to daily frequency
monthly_adj_close:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_adj_close
  query: >
    SELECT
      date,
      symbol,
      monthly_adj_close
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Monthly return percentage (월간 수익률)
# Monthly data - forward filled to daily frequency
monthly_return_pct:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_return_pct
  query: >
    SELECT
      date,
      symbol,
      monthly_return_pct
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Monthly trading volume (월간 거래량)
# Monthly data - forward filled to daily frequency
monthly_trading_volume:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_trading_volume
  query: >
    SELECT
      date,
      symbol,
      monthly_trading_volume
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Monthly trading value (월간 거래대금)
# Monthly data - forward filled to daily frequency
monthly_trading_value:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_trading_value
  query: >
    SELECT
      date,
      symbol,
      monthly_trading_value
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Monthly listed shares - common stock (월간 상장주식수 보통주)
# Monthly data - forward filled to daily frequency
monthly_listed_shares_common:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_listed_shares_common
  query: >
    SELECT
      date,
      symbol,
      monthly_listed_shares_common
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Monthly float shares (월간 유동주식수)
# Monthly data - forward filled to daily frequency
monthly_float_shares:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_float_shares
  query: >
    SELECT
      date,
      symbol,
      monthly_float_shares
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Monthly market cap in won (월간 시가총액)
# Monthly data - forward filled to daily frequency
# Note: Converted from millions to won by ETL (multiply by 1,000,000)
monthly_market_cap:
  db_type: parquet
  data_type: numeric
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_market_cap
  query: >
    SELECT
      date,
      symbol,
      monthly_market_cap
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Monthly trading suspended status (월간 거래정지 여부)
# Monthly data - forward filled to daily frequency
# Boolean: True = trading suspended, False = normal trading
monthly_is_trading_suspended:
  db_type: parquet
  data_type: boolean
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_is_trading_suspended
  query: >
    SELECT
      date,
      symbol,
      monthly_is_trading_suspended
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# FnGuide: Monthly management issue status (월간 관리종목 여부)
# Monthly data - forward filled to daily frequency
# Boolean: True = has issues, False = general (normal)
monthly_is_issue:
  db_type: parquet
  data_type: boolean
  forward_fill: true
  table: FNGUIDE_PRICE_MONTHLY
  index_col: date
  security_col: symbol
  value_col: monthly_is_issue
  query: >
    SELECT
      date,
      symbol,
      monthly_is_issue
    FROM read_parquet('data/fnguide/price_monthly/**/*.parquet', hive_partitioning=true)
    WHERE date >= :start_date
      AND date <= :end_date

# ============================================================================
# FnGuide IR Events (Event Data - Boolean Indicators)
# ============================================================================

# FnGuide: Earnings announcement events
# Boolean indicator: 1 = earnings announced on this date for this stock
# Filters: event_code = 'IR1' AND category = '실적발표'
fnguide_earnings_announcement:
  db_type: parquet
  data_type: event
  forward_fill: false
  table: FNGUIDE_IR_EVENTS
  index_col: date
  security_col: symbol
  value_col: has_event
  query: >
    SELECT
      CASE
        WHEN LENGTH(event_date) = 8 THEN STRPTIME(event_date, '%Y%m%d')
        ELSE TRY_CAST(LEFT(event_date, 10) AS DATE)
      END as date,
      symbol,
      MAX(1) as has_event
    FROM read_parquet('data/fnguide/ir_events/**/*.parquet', hive_partitioning=true)
    WHERE event_code = 'IR1'
      AND category = '실적발표'
      AND event_date >= :start_date
      AND event_date <= :end_date
    GROUP BY date, symbol

